[toc]

## 1) MySQL 架构 并发 引擎

1. 架构图

 1. 第一层: 连接处理、授权认证、安全等.

 2. 第二层: 核心服务 如: 查询解析、分析、优化、缓存、函数、存储过程、触发器、视图.

 3. 第三层: 存储引擎

 4. 优化与查询: 解析查询、优化. Select 查询前会检查 查询缓存.

2. 并发控制 - 锁 (共享锁, 排它锁) (表级锁, 行级锁)

3. 事务 (原子性A, 一致性C, 隔离性I, 持久性D)

 1. 原子性: 事务不可分割的最小单元, 整个事务操作要么全部提交成功, 要么全部失败回滚.

 2. 一致性: 数据库总是从一个一致性状态转换为另一个一致性状态.

 3. 隔离性: 一个事务在修改提交之前, 对其他事务是不可见的.

 4. 隔离级别 (未提交读, 提交读, 可重复读, 可串行化)

 5. 死锁

 6. 存储引擎 (事务日志)(InnoDB, MyISAM)

 7. 多版本控制 (MVCC)

## 2) 基准测试 

 1. `benchmark`

 2. 策略: 针对整个系统 or 针对某个单件

 3. 指标: 吞吐量 [每秒事务数 TPS], 响应时间 [百分比相应时间], 并发性, 可扩展性 (例如提升 Cpu)

 4. 集成式工具: ab, http_load

 5. 单件式测试工具: mysqlslap, sql-bench, sysbench

## 3) 服务器性能

 1. 性能剖析 (New Relic)

 2. 测量 PHP 程序 (xhprof, IfP) 

 3. 剖析 Mysql 查询 (慢查询日志, 使用 `performance_schema`)

## 4) Schema 与 数据类型 范式

1. 选择数据类型

 1. 数据类型选择(更小, 简单, 避免Null)

 2. 数据大类型(数字, 字符串, 时间)

 3. 日期时间(精确到秒) Timestamp 比 Datatime 存储小, 根据时区变化, 允许的范围也小

 4. 整数(Int:tiny 8, small 16, medium 24, int 32, big 64位) (unsigned 正数) int(1) 只是限制显示个数

 5. 实数(浮点(Float, Double)和 Decimal(18,9)) 精确计算可使用 Decimal, 数据大可使用 x100 等方式存储 Int 型

 6. 字符串 varchar (可变字长, 节省空间), char (定长, 适合存储短字符串), text, enum(枚举)

 7. 日期和时间 datetime (1001-9999年, 精确 秒, 8字节 YYYYMMDDHHMMSS 整数保存, 时区无关), timestamp (1970-2038, 时间戳, 4字节, 时区, 效率高)

 8. 位数据 bit, set

 9. 关联表使用相同类型(外键) [整数是标识列最好选择, 避免使用字符串, ]

2. schema 设计

 1. 陷阱(太多列, 太多关联, 注意枚举, 合理使用null)

 2. 范式化需要关联, 查询可能会慢, 但可以有效避免重复冗余数据, 更新方便

 3. 汇总表(用于汇总非实时数据, 可避免对原表全表查询), 缓存表(优化查询, 可使用不同引擎作为缓存表或导出到专门的搜索引擎), 影子表(可用于和原表更换表名)

## 5) 索引

## 6) 查询优化

## 7) 分区表 存储过程 触发器 分布式事务

## 8) 服务器变量 I/O 并发

## 9) 硬件 CPU 内存 磁盘

## 10) 复制 一主多从 监控

## 11) 扩展 负载均衡

## 12) 高可用

## 13) 云端

## 14) 应用层优化

## 15) 备份 恢复

## 16) MySQL工具

 